#include "optimize.h"
#include <stdio.h>

#define NOBJ  3
#define DIM  12

static double g (double *x, int k)
{
    int i;
    double s = 0;
    for (i=0; i<k; i++) {
        s += pow (x [i] - 0.5, 2);
    }
    return s;
}

static void f (double *x, int nx, double *y, int ny)
{
    int i, j;
    int k = nx - ny + 1;
    double gv;
    assert (k > 0);
    gv = g (x + nx - k, k);
    for (i=0; i<ny; i++) {
        double p = 1;
        for (j=0; j<ny-i-1; j++) {
            p *= cos (pow (x [j], 100) * M_PI / 2.0);
        }
        if (j < ny-1) {
            p *= sin (pow (x [j], 100) * M_PI / 2.0);
        }
        y [i] = p * (1 + gv);
    }
}

struct multi_problem dtlz4 =
{ .dimension      = DIM
, .n_obj          = NOBJ
, .nconstraint    = 0
, .lower          = 0
, .upper          = 1
, .popsize        = 0
, .generations    = 600
, .f              = f
, .name           = "DTLZ4"
};

#ifdef DEBUG_EVAL
#include <stdio.h>
#define K (DIM - NOBJ + 1)
int main ()
{
    int i, j;
    static double xx [][DIM] =
        { { 1.952535e-02, 2.927017e-03, 5.376568e-01, 4.460118e-01
          , 3.779109e-01, 5.819260e-01, 5.138624e-01, 5.583443e-01
          , 4.585826e-01, 4.320968e-01, 4.543905e-01, 4.808486e-01
          }
        , { 9.973921e-01, 9.942523e-01, 4.839111e-01, 4.743276e-01
          , 4.633152e-01, 4.902908e-01, 5.482980e-01, 5.536792e-01
          , 4.117031e-01, 5.037767e-01, 4.452295e-01, 4.873406e-01
          }
        , { 9.934194e-01, 9.102754e-01, 4.700166e-01, 4.485270e-01
          , 5.026402e-01, 4.918238e-01, 4.548096e-01, 5.595561e-01
          , 4.624325e-01, 4.213357e-01, 4.552393e-01, 4.779908e-01
          }
        , { 9.869871e-01, 9.948916e-01, 4.525577e-01, 5.269635e-01
          , 4.609060e-01, 5.872374e-01, 4.516029e-01, 5.066754e-01
          , 4.641729e-01, 5.086709e-01, 5.779313e-01, 5.257699e-01
          }
        , { 9.804301e-01, 6.697030e-03, 4.834121e-01, 5.125848e-01
          , 3.776705e-01, 5.491075e-01, 4.185235e-01, 4.418366e-01
          , 4.115385e-01, 4.694270e-01, 4.525557e-01, 4.943226e-01
          }
        , { 9.871345e-01, 9.985910e-01, 5.081436e-01, 4.492890e-01
          , 4.603373e-01, 5.313164e-01, 5.363851e-01, 4.446566e-01
          , 4.127253e-01, 4.557360e-01, 5.843548e-01, 4.271009e-01
          }
        , { 9.971415e-01, 9.980628e-01, 5.762805e-01, 4.461207e-01
          , 4.708373e-01, 4.918238e-01, 4.539540e-01, 5.583692e-01
          , 4.584697e-01, 4.317131e-01, 5.721102e-01, 4.794055e-01
          }
        , { 8.051884e-05, 9.999860e-01, 4.774414e-01, 5.732533e-01
          , 3.785300e-01, 6.640863e-01, 5.197208e-01, 4.441320e-01
          , 4.047983e-01, 4.550520e-01, 4.425143e-01, 4.267140e-01
          }
        , { 9.767806e-01, 9.867393e-01, 4.832743e-01, 3.392006e-01
          , 3.927594e-01, 4.730833e-01, 3.986109e-01, 4.450428e-01
          , 5.358542e-01, 4.682927e-01, 5.416751e-01, 4.537071e-01
          }
        , { 9.845469e-01, 6.697030e-03, 5.192612e-01, 5.127819e-01
          , 3.907388e-01, 5.486778e-01, 4.964394e-01, 4.412129e-01
          , 4.110656e-01, 5.167963e-01, 4.551839e-01, 4.943226e-01
          }
        , { 9.992467e-01, 9.930591e-01, 4.814840e-01, 4.147984e-01
          , 4.757188e-01, 5.036607e-01, 5.283220e-01, 5.615946e-01
          , 4.058944e-01, 4.673127e-01, 4.699784e-01, 4.554754e-01
          }
        , { 9.962662e-01, 9.835401e-01, 4.784034e-01, 4.492628e-01
          , 4.889654e-01, 4.318551e-01, 4.980295e-01, 4.283367e-01
          , 4.606738e-01, 4.307745e-01, 5.485407e-01, 4.516787e-01
          }
        , { 8.690700e-02, 9.978445e-01, 5.193687e-01, 5.271948e-01
          , 4.001365e-01, 5.344171e-01, 4.758549e-01, 4.712165e-01
          , 5.047774e-01, 5.309113e-01, 5.067674e-01, 4.519116e-01
          }
        , { 9.941241e-01, 9.987282e-01, 4.981519e-01, 4.725541e-01
          , 3.716351e-01, 4.928608e-01, 4.520641e-01, 4.406730e-01
          , 4.624325e-01, 4.849350e-01, 5.761938e-01, 4.779908e-01
          }
        , { 9.976986e-01, 9.998982e-01, 4.944150e-01, 5.372159e-01
          , 5.967018e-01, 5.039096e-01, 3.396318e-01, 5.611396e-01
          , 4.618767e-01, 4.215585e-01, 5.778908e-01, 4.517438e-01
          }
        , { 9.882934e-01, 9.978213e-01, 5.194213e-01, 5.271394e-01
          , 4.637168e-01, 5.343884e-01, 4.783954e-01, 4.709095e-01
          , 4.779757e-01, 5.033142e-01, 4.450495e-01, 4.519116e-01
          }
        , { 9.925868e-01, 9.989330e-01, 5.579165e-01, 4.422706e-01
          , 3.747156e-01, 5.013532e-01, 5.561072e-01, 5.421479e-01
          , 4.146552e-01, 4.527511e-01, 5.784516e-01, 4.784957e-01
          }
        , { 9.862909e-01, 9.819139e-01, 3.697378e-01, 4.941290e-01
          , 3.996601e-01, 5.279806e-01, 4.518044e-01, 5.390947e-01
          , 5.410862e-01, 5.129626e-01, 5.425816e-01, 4.459289e-01
          }
        , { 9.824396e-01, 9.757577e-01, 4.454106e-01, 4.883525e-01
          , 3.977405e-01, 5.773602e-01, 4.605581e-01, 5.515548e-01
          , 4.648633e-01, 4.940552e-01, 4.474486e-01, 4.732263e-01
          }
        , { 9.986638e-01, 7.691945e-04, 4.763895e-01, 6.382209e-01
          , 3.974201e-01, 5.065596e-01, 5.165285e-01, 4.415136e-01
          , 4.221742e-01, 5.230992e-01, 4.626761e-01, 4.487844e-01
          }
        , { 9.814149e-01, 9.870232e-01, 4.947313e-01, 5.370915e-01
          , 5.959244e-01, 5.338454e-01, 4.981500e-01, 5.569282e-01
          , 4.166256e-01, 5.247161e-01, 5.830328e-01, 4.547399e-01
          }
        , { 9.819782e-01, 9.950284e-01, 4.835920e-01, 4.422706e-01
          , 3.751075e-01, 5.011998e-01, 5.561072e-01, 5.421479e-01
          , 4.146552e-01, 4.550653e-01, 5.784516e-01, 4.554418e-01
          }
        , { 9.808466e-01, 9.810578e-01, 4.433990e-01, 4.898498e-01
          , 3.940292e-01, 5.280634e-01, 4.530112e-01, 5.394824e-01
          , 5.391624e-01, 4.700872e-01, 5.591185e-01, 4.537397e-01
          }
        , { 9.961976e-01, 9.983872e-01, 4.307909e-01, 4.460068e-01
          , 3.874076e-01, 4.918750e-01, 5.141057e-01, 4.283695e-01
          , 4.606550e-01, 4.264200e-01, 5.833855e-01, 4.518573e-01
          }
        , { 9.914429e-01, 1.693358e-02, 4.664287e-01, 5.304477e-01
          , 3.743300e-01, 5.029366e-01, 5.557308e-01, 4.701427e-01
          , 4.281401e-01, 5.245008e-01, 5.496369e-01, 5.113585e-01
          }
        , { 9.728539e-01, 9.999962e-01, 5.526936e-01, 5.337107e-01
          , 3.744259e-01, 6.845818e-01, 5.438387e-01, 4.441271e-01
          , 4.624055e-01, 4.558514e-01, 5.784519e-01, 4.528497e-01
          }
        , { 9.728539e-01, 9.983384e-01, 5.514004e-01, 5.356218e-01
          , 3.739223e-01, 4.920215e-01, 5.432615e-01, 4.446160e-01
          , 4.626038e-01, 4.567101e-01, 5.889710e-01, 4.531540e-01
          }
        , { 9.942439e-01, 9.808386e-01, 5.226075e-01, 5.280371e-01
          , 3.978569e-01, 5.829894e-01, 4.986041e-01, 4.466883e-01
          , 5.532059e-01, 5.295477e-01, 5.753955e-01, 4.782890e-01
          }
        , { 9.810818e-01, 9.934495e-01, 4.809656e-01, 5.325211e-01
          , 4.640000e-01, 4.323183e-01, 5.798498e-01, 4.480062e-01
          , 4.166087e-01, 4.682884e-01, 5.479832e-01, 4.544603e-01
          }
        , { 9.927014e-01, 9.947559e-01, 5.586337e-01, 4.778178e-01
          , 3.975821e-01, 5.179914e-01, 4.973395e-01, 4.708907e-01
          , 4.153730e-01, 5.287015e-01, 4.672216e-01, 4.556178e-01
          }
        , { 6.732018e-03, 9.880154e-01, 4.525106e-01, 5.235528e-01
          , 3.974067e-01, 4.882866e-01, 5.310867e-01, 5.542593e-01
          , 5.482446e-01, 5.103194e-01, 4.452667e-01, 4.862859e-01
          }
        , { 2.759699e-02, 9.735087e-01, 4.840269e-01, 4.430890e-01
          , 3.980211e-01, 4.231738e-01, 5.484279e-01, 4.428198e-01
          , 4.705300e-01, 5.096790e-01, 4.557542e-01, 4.862744e-01
          }
        , { 9.799817e-01, 9.963073e-01, 4.499477e-01, 4.776399e-01
          , 4.695186e-01, 5.396123e-01, 4.973795e-01, 4.711921e-01
          , 4.742625e-01, 5.284601e-01, 5.748091e-01, 4.525853e-01
          }
        , { 9.899369e-01, 9.857992e-01, 4.125412e-01, 4.609445e-01
          , 4.971674e-01, 5.125315e-01, 5.125566e-01, 4.448356e-01
          , 4.120191e-01, 5.036040e-01, 4.502178e-01, 4.871693e-01
          }
        , { 9.951672e-01, 6.692753e-03, 4.229003e-01, 4.681165e-01
          , 3.870832e-01, 5.449678e-01, 4.059904e-01, 4.431561e-01
          , 4.189902e-01, 4.293282e-01, 5.835107e-01, 4.453601e-01
          }
        , { 9.900528e-01, 9.963073e-01, 4.499477e-01, 4.751425e-01
          , 4.891199e-01, 5.104087e-01, 4.365337e-01, 4.714293e-01
          , 4.742625e-01, 5.284601e-01, 5.826447e-01, 4.856610e-01
          }
        , { 9.870633e-01, 9.880424e-01, 4.476941e-01, 4.154060e-01
          , 5.154286e-01, 4.868136e-01, 4.190117e-01, 4.493034e-01
          , 4.158394e-01, 5.212404e-01, 5.830246e-01, 5.413406e-01
          }
        , { 9.994973e-01, 9.992921e-01, 4.950401e-01, 5.386824e-01
          , 5.957045e-01, 5.338454e-01, 4.735934e-01, 5.569244e-01
          , 4.149269e-01, 4.585024e-01, 4.527537e-01, 4.517005e-01
          }
        , { 9.735087e-01, 9.918541e-01, 4.661591e-01, 4.508976e-01
          , 3.743000e-01, 5.028606e-01, 5.543483e-01, 4.705337e-01
          , 4.605987e-01, 4.548305e-01, 5.508671e-01, 4.517345e-01
          }
        , { 9.766933e-01, 9.971452e-01, 4.314561e-01, 5.685685e-01
          , 3.917447e-01, 5.447691e-01, 5.470691e-01, 5.277084e-01
          , 4.624083e-01, 4.724376e-01, 5.763235e-01, 4.548731e-01
          }
        , { 9.900968e-01, 9.893059e-01, 5.562242e-01, 4.521294e-01
          , 4.813322e-01, 4.897076e-01, 4.821307e-01, 4.428676e-01
          , 4.153933e-01, 4.817823e-01, 4.660628e-01, 4.516569e-01
          }
        , { 9.883810e-01, 9.921806e-01, 4.661064e-01, 4.363099e-01
          , 3.851482e-01, 5.898420e-01, 4.736260e-01, 4.159154e-01
          , 4.118603e-01, 4.317015e-01, 4.484321e-01, 4.593526e-01
          }
        , { 9.949322e-01, 9.965298e-01, 4.883277e-01, 4.705950e-01
          , 3.979029e-01, 4.352940e-01, 4.536390e-01, 4.462108e-01
          , 4.140585e-01, 4.765737e-01, 5.873839e-01, 4.270514e-01
          }
        , { 9.812095e-01, 9.983872e-01, 4.308734e-01, 4.460068e-01
          , 3.874076e-01, 4.918750e-01, 5.469008e-01, 4.431491e-01
          , 4.625997e-01, 4.264200e-01, 5.836134e-01, 4.259658e-01
          }
        , { 9.876772e-01, 9.998961e-01, 4.479778e-01, 4.572404e-01
          , 3.973742e-01, 6.562214e-01, 5.449656e-01, 5.515895e-01
          , 4.650199e-01, 4.502780e-01, 4.530732e-01, 4.637773e-01
          }
        , { 9.932672e-01, 9.917969e-01, 4.524856e-01, 4.942494e-01
          , 5.070469e-01, 4.337255e-01, 5.632733e-01, 4.468475e-01
          , 4.947416e-01, 4.704864e-01, 5.748112e-01, 4.767670e-01
          }
        , { 9.976639e-01, 9.472992e-01, 4.814156e-01, 4.483720e-01
          , 5.029796e-01, 5.652622e-01, 4.170603e-01, 4.408363e-01
          , 4.119556e-01, 5.032559e-01, 4.524188e-01, 4.779908e-01
          }
        , { 9.984216e-01, 9.945366e-01, 4.841246e-01, 4.360809e-01
          , 4.640396e-01, 4.901216e-01, 5.066334e-01, 4.151628e-01
          , 4.118612e-01, 4.554635e-01, 4.452295e-01, 4.881931e-01
          }
        , { 9.948629e-01, 9.998982e-01, 4.944150e-01, 5.372159e-01
          , 3.872800e-01, 4.919504e-01, 3.386250e-01, 7.472242e-01
          , 4.147259e-01, 4.383614e-01, 5.477429e-01, 4.517438e-01
          }
        , { 9.884612e-01, 3.982224e-03, 4.778737e-01, 4.761334e-01
          , 4.534025e-01, 6.315117e-01, 5.800162e-01, 4.265251e-01
          , 4.738788e-01, 5.091398e-01, 4.562318e-01, 4.582626e-01
          }
        , { 9.947974e-01, 9.879238e-01, 4.820402e-01, 4.145669e-01
          , 4.614483e-01, 4.310066e-01, 4.538375e-01, 4.479359e-01
          , 4.166087e-01, 5.112822e-01, 5.470572e-01, 4.548430e-01
          }
        , { 9.983981e-01, 9.880749e-01, 4.433990e-01, 4.893192e-01
          , 3.940292e-01, 5.280634e-01, 4.538544e-01, 5.394824e-01
          , 5.391624e-01, 4.700872e-01, 5.469752e-01, 4.537397e-01
          }
        , { 9.999972e-01, 2.035352e-02, 5.016691e-01, 4.859510e-01
          , 5.465914e-01, 6.302192e-01, 4.078172e-01, 4.725719e-01
          , 4.236124e-01, 4.319720e-01, 6.003594e-01, 4.335508e-01
          }
        , { 9.994068e-01, 3.047886e-02, 4.662782e-01, 4.363099e-01
          , 3.851482e-01, 5.898420e-01, 4.736260e-01, 4.159154e-01
          , 4.147860e-01, 4.577503e-01, 4.527827e-01, 4.699271e-01
          }
        , { 8.612332e-02, 9.846670e-01, 5.195024e-01, 5.349126e-01
          , 4.892148e-01, 5.490685e-01, 4.964232e-01, 4.477445e-01
          , 4.189906e-01, 5.217847e-01, 5.493915e-01, 4.541581e-01
          }
        , { 9.812782e-01, 9.993401e-01, 5.591927e-01, 4.492628e-01
          , 4.890715e-01, 4.324944e-01, 5.447199e-01, 5.633273e-01
          , 4.626185e-01, 4.307745e-01, 5.777746e-01, 4.329931e-01
          }
        , { 4.378050e-02, 9.986887e-01, 4.770326e-01, 4.780503e-01
          , 3.736196e-01, 5.341947e-01, 4.977289e-01, 4.445355e-01
          , 5.523463e-01, 4.671095e-01, 5.714540e-01, 4.537340e-01
          }
        , { 9.962774e-01, 9.902672e-01, 4.912821e-01, 4.464395e-01
          , 4.882010e-01, 5.028210e-01, 5.006010e-01, 4.708689e-01
          , 4.605709e-01, 4.306269e-01, 5.503281e-01, 4.517438e-01
          }
        , { 9.884545e-01, 9.987449e-01, 4.371080e-01, 4.503334e-01
          , 5.025191e-01, 5.653810e-01, 3.412625e-01, 4.467256e-01
          , 4.612223e-01, 5.008832e-01, 5.706837e-01, 5.289705e-01
          }
        , { 9.711288e-01, 9.899685e-01, 4.479377e-01, 5.237539e-01
          , 4.609060e-01, 5.931814e-01, 4.516029e-01, 5.066754e-01
          , 5.031055e-01, 5.117162e-01, 5.864271e-01, 4.343365e-01
          }
        , { 1.419225e-03, 9.799493e-01, 4.844832e-01, 5.269629e-01
          , 5.966104e-01, 5.343080e-01, 4.333353e-01, 5.571421e-01
          , 5.481751e-01, 5.103194e-01, 4.657270e-01, 4.862744e-01
          }
        , { 9.947903e-01, 9.930955e-01, 4.820402e-01, 4.116197e-01
          , 4.608936e-01, 4.310066e-01, 4.511844e-01, 4.479200e-01
          , 4.166087e-01, 4.684504e-01, 5.479832e-01, 4.543874e-01
          }
        , { 9.964223e-01, 9.948916e-01, 5.196572e-01, 5.269635e-01
          , 4.709959e-01, 4.895147e-01, 4.525965e-01, 5.066754e-01
          , 4.644807e-01, 5.010359e-01, 4.515184e-01, 5.149065e-01
          }
        , { 9.870720e-01, 9.972499e-01, 4.525319e-01, 3.771658e-01
          , 4.623178e-01, 5.596965e-01, 5.310867e-01, 5.628122e-01
          , 6.471971e-01, 3.829921e-01, 4.452667e-01, 5.394088e-01
          }
        , { 9.729396e-01, 9.949672e-01, 5.519461e-01, 5.351622e-01
          , 3.744231e-01, 4.920215e-01, 5.488691e-01, 4.446160e-01
          , 4.624055e-01, 4.558514e-01, 5.643258e-01, 4.537433e-01
          }
        , { 1.952535e-02, 9.932034e-01, 5.335119e-01, 4.460179e-01
          , 4.705222e-01, 5.821026e-01, 5.266499e-01, 6.316936e-01
          , 4.589126e-01, 5.209638e-01, 5.721648e-01, 4.619753e-01
          }
        , { 9.909842e-01, 9.929173e-01, 3.789492e-01, 5.251391e-01
          , 3.962818e-01, 5.339219e-01, 5.126373e-01, 4.445361e-01
          , 4.237085e-01, 4.248670e-01, 5.830966e-01, 4.524155e-01
          }
        , { 9.868348e-01, 9.757712e-01, 4.785202e-01, 4.521651e-01
          , 5.931952e-01, 5.870767e-01, 4.462640e-01, 4.851310e-01
          , 4.158960e-01, 5.418700e-01, 4.666840e-01, 4.516173e-01
          }
        , { 4.378050e-02, 9.963210e-01, 4.770326e-01, 4.780493e-01
          , 4.636631e-01, 5.341947e-01, 4.757221e-01, 4.445355e-01
          , 4.172075e-01, 4.683716e-01, 4.508411e-01, 4.537340e-01
          }
        , { 9.829663e-01, 9.902136e-01, 5.492179e-01, 5.432376e-01
          , 4.912302e-01, 4.920215e-01, 5.432615e-01, 4.446160e-01
          , 4.624055e-01, 4.765800e-01, 5.502829e-01, 4.528179e-01
          }
        , { 9.891431e-01, 9.797699e-01, 4.380461e-01, 5.389240e-01
          , 3.836037e-01, 4.294573e-01, 5.449058e-01, 4.321774e-01
          , 4.146764e-01, 4.269384e-01, 4.780466e-01, 5.171563e-01
          }
        , { 4.928606e-02, 9.950893e-01, 5.514777e-01, 4.608785e-01
          , 4.568034e-01, 5.086288e-01, 4.546339e-01, 4.547459e-01
          , 4.120828e-01, 4.250314e-01, 4.474115e-01, 5.223807e-01
          }
        , { 9.920580e-01, 9.767410e-01, 4.349016e-01, 4.510266e-01
          , 4.643602e-01, 4.904607e-01, 4.221925e-01, 5.536792e-01
          , 5.462124e-01, 4.704830e-01, 4.512255e-01, 4.873406e-01
          }
        , { 9.968663e-01, 8.874783e-02, 4.170564e-01, 5.702885e-01
          , 5.911564e-01, 5.445445e-01, 4.415947e-01, 5.549529e-01
          , 4.112927e-01, 5.246901e-01, 4.695957e-01, 5.253562e-01
          }
        , { 9.772353e-01, 9.999849e-01, 5.297070e-01, 4.907555e-01
          , 4.710261e-01, 5.838082e-01, 5.451038e-01, 4.539610e-01
          , 4.636193e-01, 5.011196e-01, 4.524971e-01, 4.865237e-01
          }
        , { 8.690700e-02, 9.906285e-01, 5.197228e-01, 5.266284e-01
          , 4.701235e-01, 4.884256e-01, 4.981546e-01, 5.352463e-01
          , 4.568323e-01, 5.294842e-01, 5.748054e-01, 4.521990e-01
          }
        , { 9.935382e-01, 9.998397e-01, 4.800277e-01, 4.761934e-01
          , 4.899931e-01, 6.316395e-01, 5.718110e-01, 4.438069e-01
          , 4.121398e-01, 4.671387e-01, 4.467558e-01, 5.986355e-01
          }
        , { 9.925868e-01, 9.876787e-01, 5.579165e-01, 4.141200e-01
          , 3.747156e-01, 5.013532e-01, 5.561072e-01, 5.421479e-01
          , 4.147572e-01, 4.527511e-01, 5.784516e-01, 4.784957e-01
          }
        , { 9.932766e-01, 9.968441e-01, 4.673488e-01, 4.507772e-01
          , 3.996601e-01, 5.293150e-01, 5.403897e-01, 3.976267e-01
          , 5.410862e-01, 5.128159e-01, 5.499392e-01, 4.506925e-01
          }
        };
    double yy [NOBJ];
    size_t sz = sizeof (xx) / (sizeof (double) * DIM);
    for (i=0; i<sz; i++) {
        double s = 0;
        f (xx [i], DIM, yy, NOBJ);
        printf ("G: %e\n", g (xx [i] + DIM - K, K));
        for (j=0; j<NOBJ; j++) {
            printf ("F %d %e\n", j, yy [j]);
            s += yy [j];
        }
        printf ("\ns: %e\n", s);
    }
}
#endif /* DEBUG_EVAL */
