#include "optimize.h"
#include <stdio.h>

/* Defaults */
#define NOBJ 3
#define DIM  7

static double g (double *x, int k)
{
    int i;
    double s = 0;
    for (i=0; i<k; i++) {
        s += pow (x [i] - 0.5, 2) - cos (20 * M_PI * (x [i] - 0.5));
    }
    return 100 * (k + s);
}

static void f (double *x, int nx, double *y, int ny)
{
    int i, j;
    int nobj = ny - 1; /* 1 for the constraint */
    int k = (nx - nobj + 1);
    double gv;
    double s = 0;
    assert (k > 0);
    gv = g (x + nx - k, k);
    for (i=0; i<nobj; i++) {
        double p = 0.5;
        for (j=0; j<nobj-i-1; j++) {
            p *= x [j];
        }
        if (j < nobj-1) {
            p *= (1 - x [j]);
        }
        y [i] = p * (1 + gv);
        if (i < nobj-1) {
            s += y [i] / 0.5;
        } else {
            y [nobj] = s + y [i] / 0.6 - 1;
        }
    }
}

struct multi_problem c1_dtlz1 =
{ .dimension      = DIM
, .n_obj          = NOBJ
, .nconstraint    = 1
, .lower          = 0
, .upper          = 1
, .popsize        = 300
, .generations    = 500
, .f              = f
, .name           = "C1-DTLZ1"
};

#ifdef DEBUG_EVAL
#define K (DIM - NOBJ + 1)
#include <stdio.h>

int main ()
{
    int i, j;
    static double xx [][DIM] =
        { { 0.9163108, 0.9095695, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.2518284, 0.9999744, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8344421, 0.6994987, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999977, 0.1673256, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.1656214, 0.9984448, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 0.1103975, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6664374, 0.1226108, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9167031, 0.8226876, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5015607, 0.5006593, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.08312098, 2.122038e-07, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.1656214, 0.4990297, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.918049, 0.4518496, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 2.996397e-05, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 6.301128e-08, 0.4525002, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 0.7766462, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5026024, 0.3340476, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999893, 2.228734e-07, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999935, 0.3339575, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8339054, 0.5990894, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999929, 0.5833031, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 0.9999185, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8339998, 0.4024114, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999221, 0.9174755, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4178704, 0.9989865, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.1656214, 8.62641e-10, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999984, 0.2496837, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6649218, 0.2500064, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4993437, 0.6667604, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5847864, 0.712716, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8339054, 0.09626684, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8339054, 0.9996613, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4993437, 0.999989, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999984, 0.6674307, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4992798, 1.353848e-05, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 0.8898066, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.2509191, 0.0006045241, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6664374, 0.5005143, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9167031, 0.2732652, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4992798, 7.216818e-06, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.08312098, 0.999338, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4992798, 0.8374724, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999919, 0.4180872, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5840487, 0.9996766, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8317039, 0.3015521, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8339998, 0.2006403, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999909, 0.750215, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6664374, 2.062908e-06, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.3343356, 0.4968162, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999999, 0.08345763, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8339054, 0.8995923, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4178704, 0.599489, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6669341, 0.3734448, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8344421, 0.5005046, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6669341, 0.6258218, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6664374, 0.7501851, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7505605, 0.6659374, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9167031, 0.724713, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999984, 0.834868, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9167504, 0.5429571, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9167031, 0.9999753, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6664374, 2.062908e-06, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.3343356, 0.9996613, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9140846, 0.09034472, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4163642, 0.0006045241, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6649218, 0.8794706, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.914565, 0.6323626, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4167718, 0.4024114, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5840487, 0.0006045241, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.3347305, 0.2500064, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 0.2220327, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5847864, 0.4266541, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.914565, 0.3651329, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.3351744, 0.7486495, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9167504, 3.47423e-05, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.08312098, 2.122038e-07, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.3342807, 0.0006045241, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.3342807, 0.0006045241, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5015229, 0.1644295, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5832279, 0.2861136, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999893, 0.5001031, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 0.5534269, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5832279, 0.8614206, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5832279, 0.5703644, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9999947, 0.9999771, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4178704, 0.7976552, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8339054, 0.0003156071, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.1656214, 8.62641e-10, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4179088, 0.194637, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.4163642, 0.0002602652, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 6.301128e-08, 0.4525002, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.6669341, 0.9996964, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5840409, 0.1421393, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 0.3338756, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.2518815, 0.3370382, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.8339592, 0.8007296, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.7497996, 0.4443162, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.9167031, 0.1792392, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.5840487, 0.0006045241, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.2518284, 0.6659374, 0.5, 0.5, 0.5, 0.5, 0.5 }
        , { 0.2509191, 0.0006045241, 0.5, 0.5, 0.5, 0.5, 0.5 }
        };
    double yy [NOBJ + 1];
    size_t sz = sizeof (xx) / (sizeof (double) * DIM);
    for (i=0; i<sz; i++) {
        double s = 0;
        f (xx [i], DIM, yy, NOBJ + 1);
        printf ("G: %e\n", g (xx [i] + DIM - K, K));
        if (yy [NOBJ] <= 0) {
            for (j=0; j<NOBJ+1; j++) {
                printf ("F %d %e\n", j, yy [j]);
                s += yy [j];
            }
        } else {
            printf ("F %d %e\n", NOBJ, yy [NOBJ]);
        }
        printf ("\ns: %e\n", s);
    }
}
#endif /* DEBUG_EVAL */
