#include <stddef.h>
#include <stdio.h>
#include <assert.h>
#include "pgapack.h"

double compute_asf (PGAContext *ctx, double *point, int axis);
void compute_utopian (PGAContext *ctx, PGAIndividual **start, int n);
void compute_extreme (PGAContext *ctx, PGAIndividual **start, int n);
int compute_intersect (PGAContext *ctx, PGAIndividual **start, int n);
void compute_worst
    (PGAContext *ctx, PGAIndividual **start, int n, double *wpop, double *wof);
void compute_nadir (PGAContext *ctx, PGAIndividual **start, int n);
int ranking (PGAContext *ctx, PGAIndividual **start, int n, int goal);
void set_nsga_state (PGAContext *ctx, int is_ev);
double find_median (PGAIndividual **s, size_t n, int m);

double pop3 [][3] =
{{0.59200264, 1.25973595, 1.06928177}
,{0.33668049, 1.73701836, 0.58860729}
,{0.06632383, 0.39695692, 2.04663035}
,{0.25462559, 0.95805078, 1.84763014}
,{1.56691598, 0.32456604, 0.77699699}
,{1.39468614, 1.06112185, 0.28415417}
,{0.49165715, 1.57516065, 0.36687402}
,{0.25219645, 1.52832133, 0.69918447}
,{0.19350479, 0.24441518, 2.03823009}
,{0.00421519, 1.0023554 , 1.89960353}
,{1.9530772 , 0.0804578 , 0.06106157}
,{1.22995435, 0.03603701, 1.49230785}
,{1.94390398, 0.33138624, 0.13822646}
,{1.20384517, 1.55884737, 0.62435854}
,{0.59739374, 0.74291846, 1.33993911}
,{1.00879625, 0.34569624, 1.62184635}
,{0.32193694, 0.86087728, 2.07955597}
,{1.16748989, 1.11720521, 1.13571308}
,{0.16932101, 2.06714265, 0.07015315}
,{0.05331214, 0.35609524, 1.44694504}
,{0.30808162, 1.81378312, 0.99359522}
,{0.05091241, 1.23561754, 0.83076159}
,{0.25347899, 0.14074459, 1.34134605}
,{1.32704271, 1.05191765, 0.54601349}
,{0.46011744, 1.03260765, 1.42242991}
,{0.09326116, 0.46870793, 1.56971846}
,{1.51139799, 0.2659622 , 0.65585821}
,{0.87693924, 0.81612064, 1.25916094}
,{0.3334751 , 1.64835976, 0.93961617}
,{0.52438602, 0.02850446, 1.61295935}
,{1.76450275, 0.40316984, 0.92311876}
,{0.70738245, 1.67520806, 0.46809858}
,{1.54665274, 0.67557381, 0.69206195}
,{0.60142408, 1.45105265, 1.0711516 }
,{1.27369097, 1.01588981, 0.20965035}
,{1.8724852 , 0.2317311 , 0.43240781}
,{1.18106135, 1.08833986, 1.49905451}
,{0.02402091, 0.16046297, 2.11222513}
,{0.23147743, 0.16866407, 1.99651279}
,{1.19388453, 0.64289518, 1.50748858}
,{0.29738157, 1.32541357, 0.76349803}
,{1.55812855, 0.63794389, 1.33363254}
,{0.75230374, 0.57150114, 1.33130107}
,{1.53830223, 0.43311618, 1.6965542 }
,{1.28723505, 0.86137531, 1.33015377}
,{0.53359748, 1.18223901, 1.26516872}
,{0.55409408, 0.49449924, 1.8326513 }
,{0.40382719, 0.75353682, 1.51244444}
,{0.91001828, 1.1018896 , 0.65642448}
,{0.64773201, 1.69230677, 0.63216507}
,{0.28587971, 0.87879756, 1.64750156}
,{0.61210389, 0.57125203, 1.68256191}
,{0.59686865, 0.20512127, 1.55331987}
,{0.44216441, 0.13774006, 1.74968488}
,{1.37173124, 0.59756938, 1.53394827}
,{0.51538914, 1.19139214, 1.41718206}
,{0.6174288 , 1.55052357, 1.22549865}
,{0.55592539, 1.47347103, 1.05184097}
,{0.22494409, 1.21045483, 0.63243309}
,{0.63462193, 1.13308044, 0.78382333}
,{0.18563641, 1.29432024, 1.05764917}
,{0.49426461, 0.20622366, 2.19938632}
,{0.5185551 , 1.81387573, 0.02649165}
,{0.7309261 , 1.34686213, 1.18318878}
,{0.34320965, 0.35092957, 1.46805473}
,{0.05038524, 1.29390942, 0.96247625}
,{0.68962815, 1.3397539 , 0.86034788}
,{0.16956981, 1.37471672, 1.16848244}
,{1.28338372, 0.29661796, 0.78446261}
,{0.36740655, 0.74203689, 1.26766327}
,{1.33692614, 0.79758974, 0.40364995}
,{0.86546472, 0.17180019, 1.35935998}
,{0.20350703, 0.49376692, 2.22405968}
,{1.41688725, 0.13626354, 0.68248411}
,{0.7189143 , 0.44157166, 1.3491942 }
,{0.28365323, 2.01618638, 0.82661351}
,{0.02597332, 0.86652861, 1.32409954}
,{1.05212941, 0.89540367, 1.28523146}
,{0.85523304, 1.51616613, 0.30206971}
,{1.45396861, 1.051698  , 0.04712763}
,{0.00523844, 0.01969276, 1.98367522}
,{0.25657941, 1.31180652, 1.12945444}
,{0.98498806, 1.23558789, 1.09579641}
,{0.76633323, 1.33764359, 0.82152697}
,{0.82402416, 1.57936609, 0.10396752}
,{0.82595538, 1.20499078, 1.51732213}
,{1.66409283, 1.29775787, 0.21067013}
,{0.10414121, 0.15014165, 2.06789412}
,{0.4136045 , 0.92521967, 1.417854  }
,{0.28818922, 0.22475283, 1.80305745}
,{0.31148591, 1.68686981, 0.81425242}
,{0.97177884, 1.31839026, 0.98843984}
,{0.13679796, 0.18122792, 1.74460377}
,{1.96718331, 0.63979882, 0.11732475}
,{0.98873743, 0.4355161 , 1.42898936}
,{1.03291285, 0.97516195, 0.17959043}
,{0.23229372, 0.08935152, 1.63973078}
,{0.45227308, 1.56357525, 0.51152652}
,{0.37152299, 1.48067771, 0.87198931}
,{0.83534425, 1.53702138, 0.99724714}};

double pop3_2 [][3] =
{{1.75521090e+000, 1.56051315e-014, 2.85987040e-038}
,{1.86468364e+000, 6.63720331e-006, 3.35671457e-069}
,{2.08582584e+000, 4.77101511e-005, 6.09673412e-006}
,{2.09676718e+000, 4.64348421e-008, 1.51978772e-016}
,{1.77884601e+000, 7.08170085e-089, 2.24706475e-054}
,{1.77535140e+000, 1.41680851e-038, 2.80272957e-099}
,{1.69040065e+000, 1.35679883e-009, 6.48404988e-086}
,{1.69947876e+000, 4.48457393e-005, 3.55804871e-057}
,{2.06193229e+000, 2.38411042e-024, 1.25146404e-004}
,{7.75432984e-001, 2.00298062e+000, 2.94745937e-016}
,{1.95568722e+000, 2.16648944e-158, 2.13476299e-170}
,{1.93418435e+000, 3.50097313e-173, 2.40570964e-025}
,{1.97678681e+000, 4.27124281e-097, 2.39156288e-135}
,{2.06617325e+000, 9.03069541e-024, 4.07656624e-071}
,{1.64445856e+000, 8.16636464e-025, 4.81958816e-022}
,{1.94102069e+000, 5.52142357e-068, 2.50453317e-020}
,{2.27361081e+000, 2.11144643e-011, 1.53273598e-013}
,{1.97510110e+000, 1.42725682e-031, 3.97218008e-041}
,{2.07519324e+000, 1.55831633e-002, 6.41377605e-167}
,{1.49107208e+000, 1.13057423e-004, 1.10062374e-007}
,{2.09092203e+000, 3.94630645e-005, 2.40575446e-050}
,{1.48075671e+000, 1.63912075e-001, 9.01591074e-043}
,{1.37232279e+000, 1.62523118e-049, 1.02103949e-006}
,{1.77924249e+000, 2.87555736e-037, 1.72859876e-070}
,{1.81694620e+000, 9.42547087e-014, 1.70663229e-024}
,{1.64085368e+000, 4.07465922e-006, 2.28683332e-009}
,{1.66889478e+000, 8.09648668e-096, 2.70300333e-059}
,{1.73797629e+000, 1.99910768e-032, 4.88762601e-029}
,{1.92644078e+000, 3.78824598e-006, 3.83648985e-049}
,{1.69629922e+000, 1.98195031e-146, 5.17284901e-010}
,{2.03178841e+000, 1.09489412e-084, 1.78673352e-052}
,{1.87771889e+000, 5.27845376e-013, 9.74723976e-080}
,{1.82413936e+000, 2.07008479e-058, 7.17045741e-061}
,{1.90121815e+000, 9.39880727e-013, 3.71096885e-042}
,{1.64264240e+000, 4.15707075e-037, 3.26248146e-109}
,{1.93568506e+000, 8.07799257e-111, 1.39588474e-084}
,{2.19694197e+000, 1.30656913e-032, 3.07125118e-032}
,{2.11832985e+000, 1.60790369e-004, 2.23372643e-002}
,{2.01695133e+000, 6.33250086e-040, 2.35076840e-004}
,{2.02760852e+000, 1.82227234e-050, 1.69444540e-027}
,{1.55823174e+000, 6.49830992e-007, 5.11864066e-049}
,{2.14786237e+000, 7.36885653e-061, 3.29202083e-037}
,{1.63246348e+000, 1.16302718e-038, 5.42711479e-022}
,{2.33072082e+000, 6.27927563e-076, 1.20693374e-028}
,{2.04162938e+000, 9.11073096e-043, 9.86944793e-035}
,{1.81192362e+000, 6.19400859e-014, 4.54054083e-031}
,{1.97741259e+000, 1.35114529e-033, 1.90839482e-012}
,{1.73734922e+000, 1.31690927e-016, 1.59693934e-017}
,{1.57263697e+000, 1.78909647e-025, 1.53739354e-056}
,{1.91913825e+000, 9.43776419e-012, 2.87279108e-067}
,{1.88898750e+000, 5.87780083e-010, 2.36955342e-017}
,{1.87936549e+000, 2.60474509e-032, 2.25833230e-015}
,{1.67664234e+000, 6.21856252e-068, 1.49731676e-012}
,{1.80993891e+000, 6.92504248e-072, 4.33067356e-008}
,{2.14283295e+000, 1.91648848e-058, 1.27874796e-029}
,{1.92183407e+000, 2.55598551e-013, 5.43662354e-028}
,{2.07055273e+000, 3.32583667e-012, 1.16536924e-039}
,{1.89381608e+000, 1.38266643e-011, 7.28139954e-043}
,{1.38411428e+000, 8.60526653e-006, 2.24850805e-052}
,{1.51690319e+000, 2.02128728e-017, 1.76549952e-046}
,{1.68176916e+000, 1.96416498e-004, 1.17171240e-036}
,{2.26365322e+000, 4.25352908e-060, 2.44011859e-007}
,{1.88672901e+000, 9.94404451e-009, 3.99227539e-205}
,{1.93603364e+000, 9.00853923e-017, 4.57799492e-038}
,{1.54794351e+000, 7.82558080e-030, 2.50927239e-010}
,{1.60025772e+000, 2.05611317e-001, 2.26454930e-039}
,{1.73514436e+000, 6.04938926e-016, 2.10513648e-048}
,{1.81216735e+000, 8.34077865e-004, 2.50736091e-035}
,{1.53311369e+000, 2.49941861e-084, 6.00226642e-047}
,{1.51412565e+000, 2.17604075e-015, 2.65277197e-020}
,{1.60824568e+000, 7.26110004e-047, 1.66963356e-079}
,{1.62061841e+000, 1.02402054e-090, 3.79036447e-020}
,{2.28728274e+000, 1.33792722e-012, 3.13179823e-007}
,{1.57858221e+000, 8.98417405e-122, 6.63010952e-055}
,{1.59127254e+000, 7.69226283e-046, 2.00491099e-019}
,{2.19744316e+000, 3.09593915e-004, 3.51958627e-061}
,{1.54137142e+000, 3.59110264e-001, 2.48675463e-020}
,{1.88694037e+000, 4.83939502e-035, 2.11299779e-032}
,{1.76675675e+000, 1.76787784e-017, 2.17894169e-096}
,{1.79508061e+000, 3.23867721e-040, 5.78592045e-178}
,{1.36055481e+000, 2.96324918e-008, 1.44370122e+000}
,{1.74995333e+000, 5.50565026e-006, 2.71910577e-035}
,{1.92292711e+000, 1.53075176e-024, 1.37804834e-041}
,{1.74684388e+000, 9.28495950e-018, 6.49322907e-051}
,{1.78443893e+000, 3.75421843e-016, 2.51093298e-143}
,{2.10629331e+000, 3.80708668e-021, 2.83016047e-029}
,{2.12079286e+000, 1.04385660e-037, 4.92929710e-120}
,{2.07592663e+000, 2.11592659e-021, 1.01296568e-002}
,{1.74281671e+000, 8.14173036e-014, 4.05190612e-022}
,{1.83972362e+000, 9.07244132e-038, 3.52112593e-006}
,{1.89883128e+000, 1.28179808e-005, 3.31884942e-055}
,{1.91298727e+000, 9.44345491e-023, 2.21390229e-046}
,{1.75931785e+000, 2.54870391e-023, 5.09454165e-004}
,{2.07193576e+000, 4.51880720e-070, 1.67911730e-144}
,{1.79144818e+000, 4.28898118e-058, 2.38542190e-023}
,{1.43181791e+000, 4.25928969e-032, 4.94420389e-110}
,{1.65851171e+000, 1.97003171e-063, 1.09050780e-004}
,{1.70615881e+000, 7.06387810e-009, 1.49354978e-071}
,{1.75806745e+000, 1.12037051e-007, 2.20838283e-048}
,{2.01363765e+000, 8.84911811e-017, 2.14305904e-048}};

double pop2 [][2] =
{{3.882596e+05, 3.857712e+05}
,{3.880793e+05, 3.855914e+05}
,{3.731847e+05, 3.756322e+05}
,{3.537261e+05, 3.561090e+05}
,{2.208094e+05, 2.226930e+05}
,{3.364104e+04, 3.437870e+04}
,{3.407082e+05, 3.383774e+05}
,{7.872088e+04, 7.984717e+04}
,{3.115652e+05, 3.093365e+05}
,{1.607294e+05, 1.623371e+05}
,{1.349962e+05, 1.364699e+05}
,{1.853652e+05, 1.836470e+05}
,{3.085546e+05, 3.107805e+05}
,{3.728845e+05, 3.753310e+05}
,{1.690521e+05, 1.674115e+05}
,{2.907724e+05, 2.886194e+05}
,{2.817167e+05, 2.838437e+05}
,{2.241410e+04, 2.301695e+04}
,{2.440601e+05, 2.420880e+05}
,{2.337118e+05, 2.317820e+05}
,{2.226396e+05, 2.207562e+05}
,{2.200008e+05, 2.218810e+05}
,{2.178970e+05, 2.160338e+05}
,{2.762702e+05, 2.783767e+05}
,{1.673916e+05, 1.690322e+05}
,{3.245897e+05, 3.223148e+05}
,{2.091781e+05, 2.073526e+05}
,{1.603399e+05, 1.619456e+05}
,{2.061804e+05, 2.043681e+05}
,{4.936157e+04, 5.025427e+04}
,{1.260629e+05, 1.246467e+05}
,{1.155188e+05, 1.141633e+05}
,{9.908502e+04, 1.003481e+05}
,{2.901129e+05, 2.879624e+05}
,{9.675443e+04, 9.551421e+04}
,{1.328568e+05, 1.314028e+05}
,{9.314252e+04, 9.192575e+04}
,{1.671488e+04, 1.723603e+04}
,{8.464049e+04, 8.580821e+04}
,{7.787274e+04, 7.676051e+04}
,{9.876198e+03, 1.027771e+04}
,{5.896944e+04, 5.800209e+04}
,{5.369796e+04, 5.277504e+04}
,{6.872397e+04, 6.977658e+04}
,{6.288882e+04, 6.389592e+04}
,{1.494024e+05, 1.478603e+05}
,{1.618471e+05, 1.602419e+05}
,{5.818526e+04, 5.915412e+04}
,{5.528712e+04, 5.623165e+04}
,{4.704675e+04, 4.791836e+04}
,{2.225386e+05, 2.206557e+05}
,{6.041314e+04, 5.943397e+04}
,{1.198503e+05, 1.184695e+05}
,{4.654546e+04, 4.741243e+04}
,{2.994148e+05, 3.016075e+05}
,{5.336149e+03, 5.047953e+03}
,{4.690428e+04, 4.777457e+04}
,{1.116179e+04, 1.074319e+04}
,{8.291522e+04, 8.176742e+04}
,{3.266600e+03, 3.041983e+03}
,{1.141138e+04, 1.098808e+04}
,{4.564553e+04, 4.479494e+04}
,{3.691995e+04, 3.769253e+04}
,{1.778741e+05, 1.761911e+05}
,{8.562078e+04, 8.679522e+04}
,{3.032946e+05, 3.010957e+05}
,{2.079979e+04, 2.138067e+04}
,{3.454990e+04, 3.529741e+04}
,{1.139849e+05, 1.126384e+05}
,{3.695532e+05, 3.719888e+05}
,{1.633550e+03, 1.475881e+03}
,{2.880573e+04, 2.813084e+04}
,{2.865135e+04, 2.933241e+04}
,{2.604292e+04, 2.540141e+04}
,{1.509846e+05, 1.494343e+05}
,{1.752930e+04, 1.700371e+04}
,{2.243527e+02, 1.684391e+02}
,{8.810041e+03, 9.189488e+03}
,{1.549698e+05, 1.533991e+05}
,{1.667106e+04, 1.719153e+04}
,{3.140142e+05, 3.117768e+05}
,{3.198851e+05, 3.176267e+05}
,{1.723255e+04, 1.671146e+04}
,{2.521681e+05, 2.501634e+05}
,{7.745669e+04, 7.857393e+04}
,{1.613795e+04, 1.563381e+04}
,{1.253801e+04, 1.298990e+04}
,{9.855590e+03, 1.025669e+04}
,{7.093994e+03, 6.761091e+03}
,{6.245694e+03, 6.565813e+03}
,{4.745664e+03, 5.025220e+03}
,{7.261632e+04, 7.154242e+04}
,{1.921280e+05, 1.938853e+05}
,{5.982499e+03, 6.295886e+03}
,{5.682887e+04, 5.778642e+04}
,{9.134503e+02, 7.965569e+02}
,{4.140542e+02, 3.366609e+02}
,{2.609871e+02, 2.003667e+02}
,{3.472679e+01, 6.229857e+01}
,{1.825427e+05, 1.808377e+05}};

double pop2_2 [][2] =
{{1.598574e+02, 1.132835e+02}
,{1.209883e+02, 1.689862e+02}
,{1.025240e+02, 1.470257e+02}
,{1.317551e+02, 8.984123e+01}
,{1.169892e+02, 7.772459e+01}
,{9.407276e+01, 5.927631e+01}
,{6.911300e+01, 1.063667e+02}
,{6.382079e+01, 9.977596e+01}
,{6.002988e+01, 9.502146e+01}
,{8.445243e+01, 5.169323e+01}
,{7.986008e+01, 4.811430e+01}
,{5.714824e+01, 9.138682e+01}
,{7.372374e+01, 4.337873e+01}
,{1.245688e+02, 1.732130e+02}
,{5.253750e+01, 8.553061e+01}
,{1.504124e+02, 1.053553e+02}
,{7.255747e+01, 1.106297e+02}
,{1.144638e+02, 7.566866e+01}
,{9.319206e+01, 5.857765e+01}
,{5.286581e+01, 8.594936e+01}
,{7.449222e+01, 4.396867e+01}
,{4.501127e+01, 7.584744e+01}
,{4.194933e+01, 7.185666e+01}
,{2.141605e+01, 4.392703e+01}
,{2.071884e+01, 4.292602e+01}
,{6.656122e+01, 3.792720e+01}
,{4.773054e+01, 7.936546e+01}
,{5.699600e+01, 3.079772e+01}
,{4.682846e+01, 2.345593e+01}
,{4.368745e+01, 2.124886e+01}
,{1.461460e+01, 3.390622e+01}
,{8.460789e+00, 2.409576e+01}
,{2.207941e+01, 7.283920e+00}
,{2.460389e+01, 4.844481e+01}
,{1.616706e+01, 4.083749e+00}
,{2.366714e+01, 4.712669e+01}
,{7.011799e+00, 2.160372e+01}
,{3.332115e+01, 1.423136e+01}
,{1.581616e+01, 3.908347e+00}
,{1.917528e+01, 4.069111e+01}
,{2.923474e+01, 1.160708e+01}
,{2.281138e+01, 7.706874e+00}
,{1.820719e+01, 3.927514e+01}
,{2.256027e+01, 7.561207e+00}
,{1.724486e+01, 3.785564e+01}
,{1.604299e+02, 1.137655e+02}
,{1.010117e+02, 1.452135e+02}
,{9.775351e+01, 1.413017e+02}
,{1.191472e+02, 7.948539e+01}
,{8.990943e+01, 5.598120e+01}
,{2.078057e+01, 6.546286e+00}
,{7.433833e+01, 1.128262e+02}
,{4.938079e+01, 2.527220e+01}
,{4.280415e+00, 1.655608e+01}
,{1.370700e+01, 3.251619e+01}
,{1.221754e+01, 3.019898e+01}
,{3.733115e+00, 1.546162e+01}
,{1.781042e+01, 4.929462e+00}
,{1.577862e+01, 3.889696e+00}
,{4.612440e+01, 7.729038e+01}
,{1.005338e+01, 2.673620e+01}
,{2.918812e+00, 1.375262e+01}
,{1.515031e+01, 3.580952e+00}
,{1.753779e+01, 4.786532e+00}
,{4.468065e-01, 7.120550e+00}
,{1.225965e+02, 1.708859e+02}
,{2.247368e-01, 6.120993e+00}
,{8.452743e+00, 8.233024e-01}
,{1.202650e+00, 8.160339e-01}
,{1.655201e+02, 1.180583e+02}
,{1.789974e+01, 3.882298e+01}
,{1.689830e+01, 4.455284e+00}
,{6.978904e+00, 2.154595e+01}
,{5.913742e+00, 1.964102e+01}
,{6.950956e+01, 4.016060e+01}
,{1.128276e+01, 1.846834e+00}
,{2.923031e+00, 1.376178e+01}
,{5.940843e+01, 9.423917e+01}
,{7.076543e+00, 2.171725e+01}
,{7.964714e+01, 1.193452e+02}
,{1.059531e+01, 1.575136e+00}
,{2.904907e+00, 8.739195e-02}
,{6.611367e+01, 1.026378e+02}
,{2.213584e+00, 2.623367e-01}
,{1.031633e+01, 1.468713e+00}
,{3.546719e-01, 6.736845e+00}
,{6.586106e+01, 3.739913e+01}
,{3.705398e+01, 1.670518e+01}
,{2.141474e+01, 6.904317e+00}
,{1.537563e+01, 3.690921e+00}
,{7.261729e-02, 2.994713e+00}
,{9.225230e+00, 1.076004e+00}
,{9.211540e+00, 1.071332e+00}
,{6.824875e-01, 1.377975e+00}
,{1.069128e+02, 6.955338e+01}
,{6.457028e-01, 1.431477e+00}
,{6.785323e-02, 5.109799e+00}
,{1.317118e+00, 7.264878e-01}
,{3.472679e+01, 6.229857e+01}
,{4.480289e+01, 2.202891e+01}};

/* From Iter # 20 */
double pop2_3 [][2] =
{{2.168490e-01, 2.354167e+00}
,{6.671299e-01, 1.400009e+00}
,{2.891270e-02, 3.348763e+00}
,{3.896069e-02, 3.249422e+00}
,{3.293760e+00, 3.427245e-02}
,{9.137920e-03, 3.626768e+00}
,{2.208177e+00, 2.642025e-01}
,{3.570455e-01, 1.966914e+00}
,{4.899667e-01, 1.690062e+00}
,{3.139250e-01, 2.072765e+00}
,{5.366213e-02, 3.127059e+00}
,{8.454458e-01, 1.167521e+00}
,{9.043109e-01, 1.100500e+00}
,{2.404096e-01, 2.279146e+00}
,{4.612021e-02, 3.187096e+00}
,{3.131417e+00, 5.309293e-02}
,{3.742458e-01, 1.927220e+00}
,{1.201842e-01, 2.733481e+00}
,{2.009935e+00, 3.390480e-01}
,{8.682605e-01, 1.141041e+00}
,{7.505683e-02, 2.979197e+00}
,{9.267045e-01, 1.076085e+00}
,{1.141072e+00, 8.682329e-01}
,{3.382231e-01, 2.011945e+00}
,{2.237860e+00, 2.540685e-01}
,{3.465454e+00, 1.916203e-02}
,{1.256423e-01, 2.707800e+00}
,{1.037949e+00, 9.627577e-01}
,{9.426449e-01, 1.059049e+00}
,{2.086299e+00, 3.086883e-01}
,{1.015121e-01, 2.827073e+00}
,{1.962029e-01, 2.424411e+00}
,{5.843419e-01, 1.526652e+00}
,{2.931718e-01, 2.127358e+00}
,{5.473429e-01, 1.588038e+00}
,{3.337368e-05, 3.976925e+00}
,{6.317697e-01, 1.452412e+00}
,{1.201728e+00, 8.167939e-01}
,{1.601845e+00, 5.392846e-01}
,{3.130296e-02, 3.323597e+00}
,{3.739015e+00, 4.401885e-03}
,{3.983777e+00, 1.648193e-05}
,{3.065134e-03, 3.781611e+00}
,{7.178629e-01, 1.328791e+00}
,{2.474969e+00, 1.821553e-01}
,{2.524261e-01, 2.242745e+00}
,{5.373900e-03, 3.712146e+00}
,{4.468346e-01, 1.773007e+00}
,{1.420323e+00, 6.532307e-01}
,{6.954781e-01, 1.359665e+00}
,{1.318242e+00, 7.256535e-01}
,{1.302527e+00, 7.373950e-01}
,{2.816673e+00, 1.034943e-01}
,{9.279081e-02, 2.874327e+00}
,{2.786579e+00, 1.093592e-01}
,{7.439138e-01, 1.293896e+00}
,{2.683927e-01, 2.196127e+00}
,{1.941477e+00, 3.680015e-01}
,{1.096037e+00, 9.083654e-01}
,{7.539990e-02, 2.977038e+00}
,{1.000726e+00, 9.992747e-01}
,{3.797089e+00, 2.640707e-03}
,{6.616711e-01, 1.407944e+00}
,{3.178554e+00, 4.715417e-02}
,{1.373543e-01, 2.654900e+00}
,{5.177070e-01, 1.639633e+00}
,{7.790545e-01, 1.248492e+00}
,{8.170375e-05, 3.963926e+00}
,{1.737470e-01, 2.506428e+00}
,{6.157568e-01, 1.476950e+00}
,{3.946017e+00, 1.833763e-04}
,{2.697167e+00, 1.279454e-01}
,{1.518117e+00, 5.896416e-01}
,{3.363525e+00, 2.755885e-02}
,{2.660147e+00, 1.361642e-01}
,{1.765398e-02, 3.486181e+00}
,{6.234251e-02, 3.063603e+00}
,{3.546463e+00, 1.364093e-02}
,{3.095741e+00, 5.785385e-02}
,{3.055130e+00, 6.355794e-02}
,{1.702425e+00, 4.833445e-01}
,{2.904907e+00, 8.739195e-02}
,{4.686042e-01, 1.730417e+00}
,{9.884847e-01, 1.011582e+00}
,{2.419200e+00, 1.976890e-01}
,{1.829227e+00, 4.192704e-01}
,{1.257854e+00, 7.716902e-01}
,{1.441796e+00, 6.388037e-01}
,{3.666681e+00, 7.249156e-03}
,{1.473344e+00, 6.180886e-01}
,{2.322919e+00, 2.264688e-01}
,{1.882453e+00, 3.943523e-01}
,{3.586060e+00, 1.130192e-02}
,{2.119554e+00, 2.960789e-01}
,{3.882437e+00, 8.767488e-04}
,{1.031051e-03, 3.872591e+00}
,{3.847817e-01, 1.903551e+00}
,{4.060284e-01, 1.857214e+00}
,{2.567107e+00, 1.582294e-01}
,{2.173513e+00, 2.763773e-01}};

double pop3_3 [][3] =
{{144.022266155, 72.0156483898, -49.4544584698}
,{123.880109659, -114.445681475, -125.576623091}
,{226.542675065, -207.395411134, -55.178803776}
,{187.978252415, 71.9392371088, -1.74765204976}
,{79.0725305778, -79.2364549633, -175.165209462}
,{152.865102388, -150.413457136, -104.452187457}
,{424.697104692, -424.041306279, 148.001849059}
,{212.306858065, -43.3560102136, 47.8260872685}
,{183.306853303, -8.15527613119, 16.7618749233}
,{304.070567364, -303.90025354, 28.2769769881}
,{72.7977855715, -72.6267018247, -179.568780006}
,{345.87982185, -126.562468232, 134.333988263}
,{734.050158974, -498.551106256, 395.871517178}
,{388.134819841, -228.798587969, 162.889085149}
,{344.897590447, -152.895900531, 44.7000255478}
,{556.674788248, -262.276821765, 266.483946096}
,{280.603531749, -255.896452497, -6.83362540512}
,{347.709898931, -346.002244743, 76.6407751332}
,{177.145142152, -121.924042317, -104.029398845}
,{368.649485275, 15.1244638451, 230.593555138}
,{355.193843679, -159.597696769, 52.5383546542}
,{395.676235446, 46.6441600269, 217.899236645}
,{207.427982225, -189.194649934, 13.2875861731}
,{849.944050034, -584.873009094, 504.008218419}
,{251.50570685, 147.434999176, 85.1373467209}
,{412.905142641, -402.199209641, 145.673373491}
,{284.444704835, 2.43107826342, 89.6342950974}
,{366.990534348, -291.983907056, 64.6202192736}
,{354.145994948, -281.784532955, 184.890216205}
,{178.611202004, -1.78338779947, 11.7439007782}
,{388.507380881, -388.647884682, 109.069745365}
,{507.589806288, -55.7332954565, 382.614210814}
,{712.735227211, -255.484913089, 517.037523235}
,{153.862561293, 97.6289522527, -13.1497287925}
,{549.071242191, -46.7324871742, 428.811727859}
,{74.4670721704, 92.5100936772, -116.151270202}
,{559.926158403, -74.6107524669, 439.7183573}
,{732.643228793, -450.040283147, 392.133199477}
,{302.8981771, -151.675399084, 22.2495031298}
,{174.311909374, 136.110782888, 5.114909347}
,{574.627215636, -201.173473862, 449.51117722}
,{346.199630898, -1.22770369179, 204.682100153}
,{263.483473864, -81.1932098856, 50.6720419792}
,{726.845975668, -467.493716002, 457.037365467}
,{318.278645108, -198.386844409, 52.0120521282}
,{319.846116926, -319.121549716, 41.9717012262}
,{215.790131342, 107.883260714, 36.539272797}
,{357.13728574, -352.396092588, 163.490409881}
,{365.687834561, -187.637576201, 58.8655388726}
,{232.76045142, 112.767529242, 55.8115471443}
,{220.29589848, 111.474911167, 64.1393941625}
,{279.037204086, -229.087708241, -13.2050072558}
,{41.9087902601, 63.3417700816, -151.86759457}
,{515.312957029, -65.7036998682, 390.752675037}
,{357.751154064, -267.776556253, 105.038004576}
,{386.615705605, -375.628422192, 97.2647863581}
,{159.306222897, -140.405725946, -115.920656439}
,{169.408109366, 22.334985836, 2.70679014784}
,{306.534097469, -306.500032621, 34.6779601933}
,{128.344067901, 110.825560637, -54.6347832851}
,{508.175355311, -253.721938631, 185.62004164}
,{314.84257966, -68.4535037464, 110.290325067}
,{603.730562074, -429.748573304, 344.899484367}
,{466.71555041, -198.65790135, 171.916535842}
,{596.126434822, -365.440683008, 324.057503353}
,{199.175955386, -97.6426193062, 25.2947088197}
,{711.520366688, -225.740189634, 519.622069595}
,{265.283402119, -70.4490534556, 54.7968432053}
,{662.222517208, -375.648261553, 382.814480738}
,{77.8046247368, -48.6140310161, -157.806122124}
,{7.80652057646, 39.1909387129, -205.528631626}
,{182.120331241, 104.632327326, -0.182440088743}
,{362.922747973, -203.929163349, 139.048219645}
,{255.440192259, 5.48497807839, 101.759945226}
,{309.22756781, -157.444783382, 10.1144169747}
,{421.1122606, -58.8338346283, 228.449692031}
,{90.1944654414, 78.5406823611, -105.796355443}
,{81.9589476304, 32.777862743, -127.990541725}
,{194.867429918, 102.891681571, 34.8690375878}
,{90.2789102787, -82.5910474007, -156.939004541}
,{402.450212137, -402.657204562, 122.721285002}
,{451.760691465, -230.423531871, 135.018487715}
,{329.983043064, -273.273240884, 84.4675127502}
,{430.012460075, 38.6196593293, 299.758439861}
,{456.356945573, -261.292135575, 139.193441663}
,{22.8024020657, 53.0701758847, -185.735302402}
,{81.3828033014, -62.2355393699, -176.858456273}
,{322.074419443, -62.156929919, 173.783273164}
,{393.961821245, -14.6215113574, 206.012152361}
,{105.803287735, 63.2853903796, -93.3395946118}
,{504.163560909, -241.287422985, 216.343133968}
,{68.5561066924, 61.5820780972, -117.123187894}
,{126.102206433, 99.9994334659, -60.9026763794}
,{545.636117738, -308.62243087, 326.030522149}
,{28.8030784704, -29.008158976, -216.334529104}
,{238.373450349, -19.0560967301, 34.8485012753}
,{352.065078496, -242.402787837, 47.7198455321}
,{366.443967427, -361.997496418, 81.9987178693}
,{680.94617468, -222.963327809, 486.917127668}
,{601.301564189, -386.796970106, 333.173295947}
,{348.875906978, -212.851841006, 80.6517229414}
,{6.3214807072, 5.16320927158, -216.416858717}
,{345.813264901, -321.10618565, 53.9779787608}
,{469.100773513, -140.186541745, 335.196777045}
,{272.835382152, -269.340232791, 73.088328052}
,{395.878201315, -12.1042521943, 208.498214552}
,{649.321835976, -492.422601917, 396.972309571}
,{37.7394671665, 1.02021118477, -188.712780453}
,{228.891636659, -199.190114907, -19.2801238997}
,{368.405672347, -238.115258441, 61.4637701868}
,{460.090861387, -456.320549105, 171.289456434}
,{381.120602637, -342.049199514, 83.5963678656}
,{159.50032538, -30.1093583937, -55.939801993}
,{313.09197223, -286.26275827, 22.8198870399}
,{292.068065149, 42.2962183083, 145.221516115}
,{405.801266576, -366.957169728, 174.74314871}
,{313.117022929, -289.038629681, 83.1967005105}
,{199.002925394, -22.1751111897, -9.62643671218}
,{167.875673971, 130.517691027, -6.17025307628}
,{240.149226419, -221.126884766, 7.81740497717}
,{228.185867791, -217.937765614, 31.1193966916}
,{370.852314051, -169.177941932, 65.3432837088}
,{553.575553424, -470.996096963, 238.878381259}
,{190.889859876, -181.422053625, -84.4588339717}
,{83.1572404381, 65.6459346681, -98.6841635231}
,{709.190115357, -518.010960105, 375.324804688}
,{530.713722149, -248.110776503, 240.674095073}
,{385.308602388, -296.843598624, 80.09598356}
,{155.149988664, 129.347853568, -17.0527577275}
,{471.938484505, -148.544172203, 337.83743985}
,{178.342755195, 77.8118845546, 15.6299122541}
,{361.80168119, 117.702568871, 224.504859595}
,{601.332258898, -341.979999232, 323.300998407}
,{232.535503158, -227.64276216, 10.6477553934}
,{414.383287625, -375.364492518, 114.880974965}
,{643.21690167, -531.356264124, 320.191520582}
,{574.947096408, -466.384794766, 330.638575138}
,{391.660857178, -382.509223455, 175.860436417}
,{207.93281648, 36.5005120483, 48.5887803778}
,{193.106787605, -5.46412088737, 28.5597190092}
,{381.542017308, -274.187919226, 145.884089795}
,{13.1699574946, -5.58237552097, -221.386242533}
,{232.666155848, -127.415595507, 61.8483543728}
,{480.30527166, -342.288652167, 222.525318657}
,{426.962603931, -416.267464654, 159.035680179}
,{197.722249018, -112.36665945, -31.5847892888}
,{273.921890899, -274.024107459, 0.884073897419}
,{312.353071641, 106.459577754, 169.107201051}
,{325.47316243, -304.226208145, 68.049402016}
,{16.1505597592, 51.8105340951, -190.527269983}
,{183.345096495, -94.7855713643, 6.10856619153}
,{72.609874326, 69.579580247, -111.819291514}
,{562.353487289, -388.371498519, 300.991891182}
,{320.904077183, -209.935005643, 89.4817463265}
,{246.501124327, 99.7248598905, 94.4176301411}
,{414.634562566, -24.6682025629, 280.479473187}
,{149.955440451, 109.751121012, -32.7233277073}
,{480.270026278, -210.070938881, 187.068492006}
,{359.956938824, -107.691050908, 153.306837163}
,{511.662553505, -208.818090114, 191.13713427}
,{328.068864015, -204.00104057, 25.4527188807}
,{270.509592637, -9.58442229933, 72.1286865321}
,{390.945896253, -240.67885994, 81.1100455377}
,{505.396164147, -143.117738175, 307.382074563}
,{237.557834965, -131.325448945, -51.7068220557}
,{349.529308211, -234.792497838, 187.567550552}
,{339.472143635, -41.7130321464, 142.098198399}
,{409.498235923, -225.869800941, 97.2210933985}
,{329.480190646, -177.320233412, 26.8755229826}
,{153.709052932, -106.375658845, -123.219831574}
,{500.698618155, -181.04730941, 296.491548758}
,{462.757275039, -171.267862783, 325.863352234}};

double pop3_4 [][3] =
{{1.24200655033, 2.06603593515, -4.88325816792}
,{1.56169614634, 1.07837050019, -2.69880358695}
,{1.8348130095, 0.919129583654, -3.17023312491}
,{1.37273190703, 1.19638711599, -2.27006580542}
,{0.84358941216, 0.480630625765, 0.015479427507}
,{0.682684682419, 0.22742905646, 0.524161325753}
,{2.46732984407, 1.20971106864, -6.49796750788}
,{3.12167030568, 1.73522187083, -11.7818526895}
,{2.20248867898, 0.747594376585, -4.35988182089}
,{2.25266492335, 0.467811099811, -4.39244250638}
,{1.75086647781, 1.65428865216, -4.71232008054}
,{2.97200897249, 0.812452116813, -8.53576432995}
,{1.34547316204, 0.0651105664536, -0.743002561032}
,{2.95544678586, 1.14434827741, -8.95105350901}
,{1.8995787579, 1.66938488881, -5.3438109222}
,{0.834982624766, 1.14778881176, -1.09494201572}
,{1.97231437562, 1.88972940516, -6.3668955863}
,{1.2850050548, 0.361415232556, -0.813848826784}
,{2.52951067847, 0.943813775467, -6.20497693474}
,{2.67781307642, 0.69311872017, -6.71240224546}
,{2.29419649013, 0.637503652643, -4.70644739534}
,{3.10044891726, 0.790220179199, -9.30312746625}
,{2.9062615614, 0.53115401361, -7.82538884101}
,{1.90863038423, 1.35021538539, -4.55700150311}
,{0.0122321427257, 0.311272876713, 0.983854638921}
,{0.389928127667, 1.41314559899, -1.1883997454}
,{1.76808887634, 0.0205039882814, -2.02827498862}
,{1.94138633469, 0.138223123286, -2.74607749409}
,{1.50795914683, 0.00135603306601, -1.17395297789}
,{1.42541203146, 0.0843075285766, -0.980352061758}
,{2.36350379341, 0.27100562929, -4.68489897338}
,{1.80059744399, 1.7526983883, -5.21641946737}
,{2.419580741, 1.07768889509, -5.92452477004}
,{0.0648480993407, 1.18014758681, -0.333107787549}
,{2.96357339669, 0.115354962017, -7.71483021042}
,{0.659650500268, 1.76921577127, -2.4812379732}
,{0.522914561713, 0.638127320419, 0.318180083624}
,{2.58953268723, 0.118950029127, -5.64560821676}
,{0.138072858372, 0.032652357108, 0.895892305344}
,{0.553536939221, 1.91924513546, -3.01169767622}
,{0.785293151284, 1.23969954104, -1.24602035197}
,{1.52194933764, 0.569229794875, -1.55545175575}
,{2.73570205158, 0.115268686833, -6.41920451089}
,{2.0558356433, 0.938283547103, -4.0225077132}
,{0.345874314619, 0.74415046164, 0.404482282216}
,{0.669597134962, 0.594765659588, 0.256398156979}
,{1.41681366641, 0.574469972116, -1.23809382411}
,{1.77768649903, 0.327442921164, -2.36481998278}
,{0.0119274058152, 1.65907098743, -1.65331961672}
,{0.60792397339, 0.62693484525, 0.334363177762}
,{1.43298790825, 0.0458888163383, -0.968393077047}
,{2.81368403198, 0.439153233094, -7.18840599682}
,{0.0535458913842, 0.790041553858, 0.419856345569}
,{1.43795259297, 0.590405592121, -1.31640931544}
,{1.94021134369, 2.23382840223, -7.71116969791}
,{2.41460235634, 1.51879222617, -7.22745774376}
,{1.87596028912, 0.866232050627, -3.18926690216}
,{1.41630672855, 1.16300396209, -2.3580500697}
,{2.47393630813, 0.494160339486, -5.46454705788}
,{1.45782686095, 0.317729674927, -1.32198192386}
,{0.612629207422, 1.51452178624, -1.56997478365}
,{1.85756861659, 0.373660972911, -2.69012412577}
,{1.96720027301, 0.863839484389, -3.52172516579}
,{1.38352795188, 1.83300080324, -4.33461069936}
,{3.12082718623, 1.94562115379, -12.6125092905}
,{2.42558974368, 0.2094746581, -4.90823868095}
,{2.45153099356, 0.205689689959, -5.02936941789}
,{2.72155278907, 1.22131364216, -7.8091157353}
,{1.23602053379, 0.859415788645, -1.36198314592}
,{0.336778673911, 0.274749257855, 0.806433884977}
,{0.920870002617, 1.49608125942, -2.16897951352}
,{3.09019779046, 0.273857254674, -8.60872898356}
,{2.59016941674, 0.0588187304719, -5.61896335972}
,{1.7104673668, 0.0226532403224, -1.82844826092}
,{1.56893575572, 0.129297450292, -1.45303387989}
,{2.64075747627, 0.137278873102, -5.92503226755}
,{0.150169818842, 0.702752723969, 0.386147548679}
,{0.318490326789, 0.571207014093, 0.544242238189}
,{1.24384560587, 1.46419229777, -2.66416674534}
,{0.507830946134, 1.22180521135, -0.650719195651}
,{0.377346503585, 0.275187610472, 0.702689276436}
,{2.39812451354, 0.421496199024, -5.02232532896}
,{1.34506521155, 0.690951910045, -1.26078143017}
,{1.45980130925, 0.831685912516, -1.86457180833}
,{3.09996670507, 0.373134691292, -8.78292365467}
,{0.563992042567, 0.372933373161, 0.443130071229}
,{1.77381066026, 0.597573319202, -2.45672391646}
,{1.52171364637, 0.666339033351, -1.66471490641}
,{1.11116516175, 0.929257499958, -1.08344899576}
,{1.30553651247, 0.30346716841, -0.883662374283}
,{2.30984502475, 2.12613720083, -8.77698121707}
,{1.30657309387, 1.26511396124, -2.21095431451}
,{0.122363463858, 0.804550942583, 0.262986055088}
,{0.285454096314, 1.46336867676, -1.32275652921}
,{2.05969296906, 1.51436523326, -5.6108832489}
,{2.58970833689, 1.45802831889, -7.86676613744}
,{2.94365326317, 1.40243092482, -9.56446260938}
,{2.90464411658, 0.632953204996, -7.93337394448}
,{0.275320998818, 1.38711241703, -1.09988034619}
,{2.39648695235, 1.20971106864, -6.16997106457}
,{2.39541953242, 1.33562707267, -6.54998000623}
,{0.406038479011, 1.26478475208, -0.739046917067}
,{2.5560773176, 1.36718846523, -7.40319151296}
,{2.58422432958, 0.0306674442793, -5.58095292249}
,{1.35780088481, 1.48087456775, -2.95969618958}
,{2.538234492, 0.754132631394, -6.0204924601}
,{0.551042713049, 0.769312899279, 0.0177432051874}
,{1.20424045722, 0.244387931875, -0.609728814048}
,{3.05569946665, 0.0921058840312, -8.25718184819}
,{2.70500181631, 1.25399095394, -7.81066871531}
,{2.78799633757, 1.2078502462, -8.13513505972}
,{2.83490302454, 1.20443440505, -8.3883844318}
,{0.789490691939, 1.20232788728, -1.16806508588}
,{2.52951067847, 1.16617310984, -6.67749846185}
,{2.21664418328, 1.14502214195, -5.20226655627}
,{2.91355457505, 0.637503652643, -7.99059622844}
,{2.64127111266, 1.08994660469, -7.06431922678}
,{1.86498863759, 1.20027143173, -4.01507162566}
,{1.80427936302, 0.468766702243, -2.5353159345}
,{0.477095738553, 0.815235887356, 0.0498487704507}
,{1.21696882759, 0.047865368779, -0.402441530399}
,{0.881948884094, 0.37536052981, 0.180072996039}
,{2.26870103472, 0.825291588319, -4.75168581216}
,{1.42541203146, 1.06177175748, -2.22747143401}
,{1.39748930458, 1.04413636196, -2.10979191692}
,{1.80059744399, 0.969400394778, -3.18668969806}
,{2.419580741, 0.790990302344, -5.44640738427}
,{2.73171699429, 1.52480611471, -8.81607133848}
,{1.59572653874, 0.923329785393, -2.45020081485}
,{0.120996058394, 0.914298011424, 0.0984888908949}
,{0.258395243748, 1.3089056217, -0.879975394478}
,{0.659650500268, 0.145577623024, 0.449185536732}
,{0.276812993315, 0.814400015756, 0.310677511928}
,{0.287786180821, 0.136575223078, 0.96773660874}
,{1.61886123292, 0.789142222511, -2.18725408033}
,{0.634690917607, 0.567954326926, 0.337772899101}
,{3.02671695206, 0.788287354043, -8.84179950821}
,{2.70528719066, 0.762246393542, -6.93087680692}
,{1.5035401869, 0.71110095929, -1.6955743308}
,{2.471432812, 0.614354212253, -5.55812120986}
,{2.4355783143, 0.594765659588, -5.36287492227}
,{2.60789472494, 0.574469972116, -6.22581552219}
,{0.693109342046, 0.562734485416, 0.194508576453}
,{0.882278450279, 0.297022460406, 0.179840558617}
,{2.86985896752, 0.517448365267, -7.59974207124}
,{0.542849061031, 0.0521325018594, 0.706489549442}
,{2.538234492, 0.439153233094, -5.72757710151}
,{0.0535458913842, 0.344118310869, 0.80044197715}
,{1.32352815499, 0.345562397927, -0.92974238055}
,{1.29691214522, 0.31708059807, -0.859328639659}
,{2.18915911248, 0.190424277901, -3.81052734098}
,{1.59432435634, 1.42335852736, -3.50609095157}
,{1.41630672855, 0.314628672468, -1.19864692117}
,{2.36555449441, 0.300366517926, -4.72956389039}
,{1.63428350725, 0.0329749693341, -1.57713447482}
,{2.10112299632, 0.615895346125, -3.80900474942}
,{1.34425402932, 0.412329616601, -0.972077002151}
,{1.96720027301, 0.247234800053, -2.97265011872}
,{2.36662021346, 0.244387931875, -4.66816955677}
,{1.73859513709, 0.236809969411, -2.13485919539}
,{1.48433670924, 0.2094746581, -1.30941890084}
,{0.168536888745, 0.205689689959, 0.928039315574}
,{1.34845779582, 0.152601798232, -0.864639114796}
,{1.35815898843, 0.121760417876, -0.84544696507}
,{3.1059428108, 0.0752935494068, -8.55997525002}
,{1.63441159673, 0.0600174477345, -1.59165795381}
,{2.20273124718, 0.329611500248, -4.03280526131}
,{0.095136983416, 0.047865368779, 1.02720577906}
,{1.44919583278, 0.0588187304719, -1.02396165411}
,{3.05435510074, 0.0292666101026, -8.2311144549}
,{2.64075747627, 1.3677142731, -7.82360878456}
,{2.6225032547, 0.462870650843, -6.1858330719}
,{0.00709934248182, 1.22180521135, -0.393290211988}
,{2.64372207391, 0.745163562573, -6.57567304412}
,{0.410878027359, 0.83402621574, 0.18613744278}
,{2.86985896752, 0.307294626432, -7.3440712355}
,{0.563992042567, 1.33562707267, -1.00258757084}
,{2.73027495498, 0.611601061285, -6.92116274313}
,{0.30943287431, 0.94104721668, 0.0548900793247}
,{0.832673496353, 1.28268881894, -1.43639279498}
,{2.77919306302, 0.245428686907, -6.7680691508}};

double pop2_4 [][2] =
{{0.0, 0.0}
,{0.0, 0.0}
,{0.0, 1.0}
,{1.0, 1.0}
,{1.0, 2.0}
,{2.0, 2.0}};

double ideal [] = {0.00421519, 0.01969276, 0.02649165};
double nadir [] = {1.96718331, 2.06714265, 1.98465785};
size_t npop2  = sizeof (pop2)   / 2 / sizeof (double);
size_t npop3  = sizeof (pop3)   / 3 / sizeof (double);
size_t npop33 = sizeof (pop3_3) / 3 / sizeof (double);
size_t npop34 = sizeof (pop3_4) / 3 / sizeof (double);
size_t np24   = sizeof (pop2_4) / 2 / sizeof (double);

void test_pop (PGAContext *ctx, int dim, size_t npop, void *p, int goal)
{
    size_t sz;
    int i, j;
    double (*pop) [dim] = p;
    double (*extreme) [dim];
    double wpop [dim];
    double wof [dim];
    PGAIndividual *start [npop];
    unsigned int max_rank, idx;

    ctx->ga.extreme_valid = ctx->ga.utopian_valid = PGA_FALSE;
    ctx->ga.worst_valid = PGA_FALSE;
    for (sz=0; sz<npop; sz++) {
        PGAIndividual *ind = ctx->ga.newpop + sz;
        ind->rank = UINT_MAX;
        ctx->ga.oldpop [sz].rank = UINT_MAX;
        start [sz] = ind;
        for (j=0; j<dim; j++) {
            if (j==0) {
                ind->evalue = pop [sz][j];
            } else {
                ind->auxeval [j-1] = pop [sz][j];
            }
        }
    }
    max_rank = ranking (ctx, start, npop, goal);
    // Print individuals sorted by rank
    printf ("Individuals sorted by rank, max_rank=%u:\n", max_rank);
    if (max_rank > npop) {
        max_rank = npop - 1;
    }
    i = 0;
    for (idx=0; idx<max_rank + 1; idx++) {
        printf ("Rank %u:", idx);
        for (sz=0; sz<npop; sz++) {
            if (ctx->ga.newpop [sz].rank == idx) {
                printf (" %zu", sz);
                i++;
            }
        }
        printf ("\n");
        if ((size_t)i == npop) {
            break;
        }
    }
    fflush (stdout);
    if (PGAGetPopReplaceType (ctx) != PGA_POPREPL_NSGA_III) {
        return;
    }

    compute_utopian   (ctx, start, npop);
    compute_extreme   (ctx, start, npop);
    compute_intersect (ctx, start, npop);
    printf ("Utopian: ");
    for (j=0; j<dim; j++) {
        printf ("%e ", ctx->ga.utopian [j]);
    }
    printf ("\nIntersect: ");
    for (j=0; j<dim; j++) {
        printf ("%e ", ctx->ga.nadir [j]);
    }
    compute_nadir   (ctx, start, npop);
    printf ("\nNadir (norm): ");
    for (j=0; j<dim; j++) {
        printf ("%e ", ctx->ga.nadir [j] - ctx->ga.utopian [j]);
    }
    printf ("\n");
    printf ("Nadir: ");
    for (j=0; j<dim; j++) {
        printf ("%e ", ctx->ga.nadir [j]);
    }
    printf ("\n");
    ctx->ga.worst_valid = PGA_FALSE;
    compute_worst (ctx, start, npop, wpop, wof);
    printf ("worst: ");
    for (j=0; j<dim; j++) {
        printf ("%e ", ctx->ga.worst [j]);
    }
    printf ("\n");
    printf ("wpop: ");
    for (j=0; j<dim; j++) {
        printf ("%e ", wpop [j]);
    }
    printf ("\n");
    printf ("Worst of front: ");
    for (j=0; j<dim; j++) {
        printf ("%e ", wof [j]);
    }
    printf ("\n");
    printf ("Extreme:\n");
    extreme = ctx->ga.extreme;
    for (i=0; i<dim; i++) {
        printf ("[ ");
        for (j=0; j<dim; j++) {
            printf ("%e ", extreme [i][j]);
        }
        printf ("]\n");
    }
    fflush (stdout);
}

/* We need a test that works over both populations to detect bugs when
 * the ranking stops at goal
 */
void test_pop_2gen (PGAContext *ctx, int dim, size_t npop, void *p1, void *p2)
{
    size_t sz;
    int i, j;
    double (*oldpop) [dim] = p1;
    double (*newpop) [dim] = p2;
    PGAIndividual *start [2 * npop];
    unsigned int max_rank, idx;

    for (sz=0; sz<npop; sz++) {
        PGAIndividual *oind = ctx->ga.oldpop + sz;
        PGAIndividual *nind = ctx->ga.newpop + sz;
        oind->rank = UINT_MAX;
        nind->rank = UINT_MAX;
        start [2 * sz]     = oind;
        start [2 * sz + 1] = nind;
        for (j=0; j<dim; j++) {
            if (j==0) {
                oind->evalue = oldpop [sz][j];
                nind->evalue = newpop [sz][j];
            } else {
                oind->auxeval [j-1] = oldpop [sz][j];
                nind->auxeval [j-1] = newpop [sz][j];
            }
        }
    }
    max_rank = ranking (ctx, start, 2 * npop, npop);
    // Print individuals sorted by rank
    printf ("Individuals sorted by rank, max_rank=%u:\n", max_rank);
    if (max_rank > 2 * npop) {
        max_rank = 2 * npop - 1;
    }
    /* Re-compute start in correct order, was sorted by ranking */
    for (sz=0; sz<npop; sz++) {
        PGAIndividual *oind = ctx->ga.oldpop + sz;
        PGAIndividual *nind = ctx->ga.newpop + sz;
        start [2 * sz]     = oind;
        start [2 * sz + 1] = nind;
    }
    i = 0;
    for (idx=0; idx<=max_rank; idx++) {
        printf ("Rank %u:", idx);
        for (sz=0; sz<npop*2; sz++) {
            if (start [sz]->rank == idx) {
                printf (" %zu", sz);
                i++;
            }
        }
        printf ("\n");
        if ((size_t)i == npop) {
            break;
        }
    }
}

void test_median (PGAContext *ctx, int n)
{
    int i;
    int is_ev = ctx->nsga.is_ev;
    PGAIndividual *indivs [200];
    for (i=0; i<n; i++) {
        indivs [i] = ctx->ga.newpop + i;
    }
    set_nsga_state (ctx, 1);
    for (i=0; i<ctx->ga.NumAuxEval + 1; i++) {
        printf ("med-e (%d): %.12g\n", i, find_median (indivs, n, i));
        fflush (stdout);
    }
    set_nsga_state (ctx, 0);
    for (i=0; i<ctx->ga.NumConstraint; i++) {
        printf ("med-c (%d): %.12g\n", i, find_median (indivs, n, i));
        fflush (stdout);
    }
    set_nsga_state (ctx, is_ev);
}

int main (int argc, char **argv)
{
    PGAContext *ctx;
    /* Example from slides EMO '19 */
    size_t sz;
    double utop [] = {0.1, 0.1, 0.1};
    double f [][3] =
        { { 1.0, 0.1, 0.2 }
        , { 0.2, 1.0, 0.1 }
        , { 0.2, 0.5, 1.0 }
        , { 0.1, 0.9, 0.9 }
        , { 0.4, 0.4, 0.9 }
        , { 0.3, 0.3, 100 }
        };
    size_t dl = sizeof (f) / (3 * sizeof (double));

    MPI_Init (&argc, &argv);
    ctx = PGACreate (&argc, argv, PGA_DATATYPE_REAL, npop3, PGA_MINIMIZE);
    printf ("%zu\n", npop3);
    ctx->ga.NumAuxEval = 2;
    ctx->ga.NumConstraint = 0;
    ctx->ga.utopian = utop;
    for (sz=0; sz<dl; sz++) {
        printf ("%e\n", compute_asf (ctx, f [sz], 2));
    }
    PGASetPopReplaceType (ctx, PGA_POPREPL_NSGA_III);
    PGASetPopSize (ctx, 100);
    PGASetUp (ctx);
    ctx->ga.NumAuxEval = 1;
    assert (sizeof (pop2)   / 2 / sizeof (double) == npop2);
    assert (sizeof (pop2_2) / 2 / sizeof (double) == npop2);
    assert (sizeof (pop2_3) / 2 / sizeof (double) == npop2);
    assert (sizeof (pop2_4) / 2 / sizeof (double) == np24);
    assert (sizeof (pop3)   / 3 / sizeof (double) == npop3);
    assert (sizeof (pop3_2) / 3 / sizeof (double) == npop3);
    set_nsga_state (ctx, 1);
    test_pop (ctx, 2, npop2, pop2,   npop2);
    test_pop (ctx, 2, npop2, pop2_2, npop2);
    test_pop (ctx, 2, npop2, pop2_3, npop2);
    /* Don't exec nsgaiii-code */
    ctx->ga.PopReplace = PGA_POPREPL_NSGA_II;
    printf ("np24: %zu\n", np24);
    test_pop (ctx, 2, np24,  pop2_4, np24 + 1);
    test_median (ctx, np24);
    ctx->ga.PopReplace = PGA_POPREPL_NSGA_III;
    test_pop_2gen (ctx, 2, npop2, pop2, pop2_2);
    ctx->ga.NumAuxEval = 2;
    set_nsga_state (ctx, 1);
    test_pop (ctx, 3, npop3, pop3,   npop3);
    test_pop (ctx, 3, npop3, pop3_2, npop3);
    {
        double minasf = -1;
        double d [3];
        int asfidx = 0;
        for (sz=0; sz<npop3; sz++) {
            int j;
            double asf;
            memcpy (d, pop3_2 [sz], 3 * sizeof (double));
            for (j=0; j<3; j++) {
                if (d [j] < 1e-3) {
                    d [j] = 0;
                }
            }
            asf = compute_asf (ctx, d, 0);
            if (asfidx == 0 || asf < minasf) {
                minasf = asf;
                asfidx = sz;
            }
        }
        printf ("ASF22: %e\n", compute_asf (ctx, pop3_2 [22], 0));
        printf ("ASF: min: %e idx: %d\n", minasf, asfidx);
        fflush (stdout);
    }
    PGADestroy (ctx);
    ctx = PGACreate (&argc, argv, PGA_DATATYPE_REAL, 200, PGA_MINIMIZE);
    PGASetPopReplaceType (ctx, PGA_POPREPL_NSGA_II);
    PGASetPopSize (ctx, 200);
    PGASetSumConstraintsFlag (ctx, PGA_FALSE);
    ctx->ga.NumAuxEval = 2;
    ctx->ga.NumConstraint = 2;
    PGASetUp (ctx);
    set_nsga_state (ctx, 0);
    test_pop (ctx, 3, npop33, pop3_3, npop33 - 101);
    test_median (ctx, npop33);
    test_pop (ctx, 3, npop34, pop3_4, npop34 - 101);
    test_median (ctx, npop34);
    MPI_Finalize ();
}
